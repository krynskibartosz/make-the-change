# üèóÔ∏è Plan de Refactoring & Migration : `apps/web-client`

Ce plan vise √† aligner l'architecture de `apps/web-client` sur les standards robustes de `apps/web` (Admin), tout en respectant les sp√©cificit√©s de Next.js 16 et l'outillage existant (Biome).

## üìã Phase 1 : Standardisation du Socle & Outillage (Semaine 1)

### 1.1 Nettoyage & Configuration Linter

* **Action** : Confirmer **Biome** comme unique source de v√©rit√© pour le linting/formatting.

* **T√¢che** :

  * Supprimer `eslint.config.mjs` de `apps/web` s'il est inutilis√© (pour √©viter la confusion).

  * V√©rifier que le plugin VSCode Biome est recommand√© dans `.vscode/extensions.json`.

  * Standardiser les scripts `package.json` : `lint`, `format` sur tous les workspaces.

### 1.2 Strat√©gie de Gestion des Formulaires (Hybride)

Adoption d'une strat√©gie adapt√©e √† la complexit√©, conforme √† Next.js 16 :

* **Formulaires Simples** (Login, Newsletter, √âdition Profil simple) :

  * Utiliser **Server Actions** + `useActionState` (Hook natif React 19/Next 16).

  * *Avantage* : Moins de JS client, Progressive Enhancement natif.

* **Formulaires Complexes** (Checkout, Wizard Investissement) :

  * Utiliser **React Hook Form** + **Zod Resolver**.

  * *Avantage* : Validation temps r√©el, gestion des champs d√©pendants, UX fluide.

***

## üèóÔ∏è Phase 2 : Refactoring Structurel (Semaine 2)

### 2.1 Adoption du Pattern "Controller / View"

Appliquer ce pattern sur les pages riches du Dashboard Utilisateur (`dashboard/profile`, `dashboard/settings`).

* **Structure Cible** :

  ```text
  src/app/[locale]/(dashboard)/dashboard/profile/
  ‚îú‚îÄ‚îÄ page.tsx               # Server Component (Data Fetching)
  ‚îú‚îÄ‚îÄ profile.controller.tsx # Client Component (Logique, useActionState/RHF)
  ‚îú‚îÄ‚îÄ profile.view.tsx       # UI Component (Pr√©sentation pure, Props)
  ‚îî‚îÄ‚îÄ actions.ts             # Server Actions (Mutations Zod-safe)
  ```

### 2.2 Colocation des Ressources

* D√©placer les composants sp√©cifiques (ex: `ProfileHeader`, `StatsCard` sp√©cifique) depuis `src/components/dashboard` vers le dossier de la route concern√©e.

* Ne garder dans `src/components` que les √©l√©ments r√©ellement partag√©s.

***

## üöÄ Phase 3 : Am√©lioration UX & Performance (Semaine 3)

### 3.1 Optimistic UI

* Impl√©menter un hook `useOptimisticAction` (inspir√© de `apps/web`) pour les formulaires clients.

* Objectif : Feedback imm√©diat lors des mises √† jour (ex: changement de pr√©f√©rence de notification) sans attendre le serveur.

### 3.2 Server Actions Robustes

* S'assurer que toutes les Server Actions dans `web-client` utilisent Zod pour la validation des entr√©es (comme dans `web`).

* Ajouter des `revalidatePath` ou `revalidateTag` pr√©cis pour rafra√Æchir les donn√©es sans recharger la page.

***

## üõ°Ô∏è Risques & Mitigations

| Risque                  | Impact                   | Solution                                                                                                              |
| :---------------------- | :----------------------- | :-------------------------------------------------------------------------------------------------------------------- |
| **R√©gression Checkout** | Critique (Perte revenus) | **Exclure le Checkout** du refactoring initial. Le traiter dans une phase ult√©rieure d√©di√©e avec tests E2E intensifs. |
| **Complexit√© Hybride**  | Moyen (DX)               | Documenter clairement quand utiliser `useActionState` vs `React Hook Form` dans un `CONTRIBUTING.md`.                 |
| **Conflits CSS**        | Faible                   | Biome g√®re bien Tailwind. Continuer d'utiliser `packages/core/ui` pour les primitives.                                |

