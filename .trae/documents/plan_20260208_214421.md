# Plan de Population de la Base de Données (Optimisé)

Ce plan révisé intègre les URLs spécifiques fournies et une stratégie technique optimisée pour chaque source.

## 1. Objectifs
- **Peupler la DB** avec des produits réels et riches (descriptions, images, prix).
- **Créer une structure cohérente** : Producteurs -> Catégories -> Produits.
- **Utiliser la meilleure méthode par site** : API JSON (Habeebee) vs Scraping DOM (Ilanga Nature).

## 2. Cibles & Stratégies

### A. Habeebee (Bruxelles)
*   **URL Source** : `https://habeebee.be/collections/all`
*   **Méthode Technique** : **API Shopify JSON** (`https://habeebee.be/products.json`).
    *   *Avantage* : Données structurées, fiables, pas de parsing HTML fragile, récupération directe de toutes les variantes et images HD.
*   **Mapping Données** :
    *   `vendor` -> `investment.producers` ("Habeebee")
    *   `product_type` -> `commerce.categories` (ex: "Savons", "Baumes")
    *   `title` -> `commerce.products.name_i18n`
    *   `body_html` -> `commerce.products.description_i18n` (avec nettoyage HTML)
    *   `images[0].src` -> `commerce.products.images`
    *   `variants[0].price` -> `commerce.product_variants.price`

### B. Ilanga Nature (Madagascar)
*   **URL Source** : `https://www.ilanga-nature.com/en/shop`
*   **Méthode Technique** : **Puppeteer (Scraping)**.
    *   Le site ne semble pas exposer de JSON public simple, nous simulerons donc un navigateur pour extraire les cartes produits.
*   **Données à Scraper** :
    *   Nom du produit.
    *   Catégorie (déduite des filtres ou du fil d'Ariane).
    *   Prix.
    *   Image URL.
    *   Lien vers le détail (pour récupérer la description longue si besoin).

## 3. Plan d'Exécution Technique

### Étape 1 : Script de Seeding (`apps/web/scripts/seed-producers.ts`)
Je vais créer un script TypeScript exécutable via `tsx` ou `node` qui orchestre le tout.

#### Module Habeebee
1.  `fetch('https://habeebee.be/products.json')`
2.  Transformation du JSON Shopify vers notre schéma DB.
3.  Upsert du Producteur "Habeebee".
4.  Upsert des Catégories trouvées.
5.  Insertion des Produits et Variantes.

#### Module Ilanga Nature (Puppeteer)
1.  Lancement de Puppeteer (`puppeteer.launch()`).
2.  Navigation vers `/en/shop`.
3.  Sélecteurs CSS pour extraire la grille produits (ex: `.product-item`).
4.  Extraction des données.
5.  Fermeture du navigateur.
6.  Transformation et Insertion en DB.

### Étape 2 : Fonctions Utilitaires
*   **`cleanHtml(html)`** : Pour transformer les descriptions HTML de Shopify en texte ou Markdown propre pour notre DB.
*   **`downloadAndUploadImage(url)`** : (Optionnel pour V1) Pour ne pas dépendre des CDNs externes, idéalement nous devrions télécharger les images et les uploader sur Supabase Storage. Pour ce plan rapide, nous utiliserons les URLs externes directes (hotlinking) dans un premier temps.

## 4. Structure des Fichiers
```text
apps/web/scripts/
├── seed-producers.ts        # Point d'entrée
├── scrapers/
│   ├── habeebee.ts          # Logique API JSON
│   └── ilanga.ts            # Logique Puppeteer
└── utils/
    ├── supabase-admin.ts    # Client Supabase avec droits admin
    └── text-cleaner.ts      # Nettoyage HTML
```

## 5. Validation
*   Exécuter le script.
*   Vérifier le dashboard admin pour voir les nouveaux produits "Habeebee" et "Ilanga Nature".
*   Vérifier que les relations (Producteur -> Produit) sont correctes.
